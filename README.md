# 项目说明

本项目基于 STM32F429IGT6 + HAL + FreeRTOS 开发，使用 CMake + Ninja + arm-gcc 构建程序，openocd 烧录程序。采用分层架构组织代码，以区分 系统内核、MCU 平台相关代码以及应用逻辑，提升工程的可维护性与可扩展性。

## 项目结构说明

本项目框架源自于我曾经对bsp层的疑惑：我在bsp层封装了外围设备与外部设备的驱动代码。然后发现在bsp层中，外部设备往往需要外围设备的驱动才可以使用，这就导致在bsp的文件夹中各文件之间的依赖关系复杂，且没有一个对与GPIO等资源集中分配的地方。

在AI的帮助下，我设计出这样的一个项目结构作为开发框架的探索。


### 一、整体目录结构
```C
.
├── mcu/            // MCU 应用域：运行在 STM32 上的全部应用代码
│   ├── core/           // 系统入口与中断：main、it、中断向量、OS glue
│   ├── Libraries/      // 芯片支持层：CMSIS + HAL
│   ├── drivers/        // 片上外设驱动：GPIO / I2C / SPI / TIM / CAN 等
│   ├── board/          // 板级支持层：引脚映射、外设实例装配
│   ├── devices/        // 外部器件驱动：OLED / 传感器 / 显示模块等
│   ├── services/       // 业务服务层：事件总线、协议解析、log等
│   └── app/            // 应用层：业务逻辑与状态机
│
├── crm/            // 系统运行时 / 内核域
│   └── FreeRTOS/       // FreeRTOS 内核源码
│
├── project/        // 构建系统相关（CMake / Toolchain /ld）
├── doc/            // 文档与资料
└── README.md
```
### 二、目录分层设计说明

#### mcu/ —— MCU 应用域

mcu/ 目录包含所有假设运行在 MCU（STM32）上的代码，这些代码通常依赖：

- ARM Cortex-M 架构

- 中断机制

- HAL / FreeRTOS

- 受限内存环境

##### mcu/core/

- 系统启动入口（main.c）

- 中断服务函数（*_it.c）

- RTOS 启动与系统初始化胶水代码

职责：

搭建系统运行骨架，不包含具体业务逻辑。

##### mcu/Libraries/

- CMSIS

- STM32 HAL 库

- LVGL 库

> 职责：
> 
> 保存第三方库，可直接被项目使用，尽可能不做改动

##### mcu/drivers/（外设驱动层）

- GPIO  
- UART 
- SPI
- I2C 
- TIM 
- DMA
- CAN 
- 等等

对 MCU 片上外设的抽象封装

> 特点：
>
> 面向“外设能力”，不关心具体业务用途
>
> 不包含外部器件的通信协议或行为逻辑

##### mcu/board/

- 引脚映射

- 外设实例选择

- 板级初始化顺序

- 硬件版本差异

> 职责：
> 
> 描述“这块 PCB 是什么样的”，统一管理硬件资源装配。

##### mcu/devices/（外部器件驱动层）

- 外接模块与芯片驱动

- OLED、传感器、Flash、显示模块等

> 特点：
>
> 使用 drivers/ 提供的接口
>
> 不直接操作 HAL
>
> 不包含业务状态机

##### mcu/services/（业务服务层）

- 事件总线（Event Bus）

- 通信协议解析

- 路由与调度

- 公共服务模块

> 职责：
>
> s为应用层提供可复用的“业务能力”，但不直接控制硬件行为。

##### mcu/app/（应用层）

- 产品业务逻辑

- 状态机

- 功能流程控制

> 设计原则：
>
> 不直接调用 HAL
>
> 不初始化外设
>
> 通过 services/ 与 devices/ 完成业务动作

#### crm/ —— 系统内核域

##### crm/FreeRTOS/

- FreeRTOS 内核源码

- 任务调度、上下文切换、系统时基

> 说明：
>
> 与具体业务逻辑无关
>
> 理论上可替换为其他 RTOS
>
> 与 mcu/ 形成“应用域 vs 系统内核域”的区分

### 三、架构设计原则总结

> 依赖方向自上而下：
> 
> app → services → devices → drivers → Libraries

- BSP 只描述硬件事实，不包含业务逻辑

- 应用层采用事件驱动 + 状态机模型

外界输入 → 事件

事件 + 状态 → 动作

目录结构服务于可维护性，而非绝对形式

### 四、设计取舍说明

本项目为 MCU 学习与工程实践项目：

业务逻辑当前假设运行在 MCU + FreeRTOS 环境

因此 app/ 与 services/ 位于 mcu/ 下

若未来需要跨平台复用业务逻辑，可进一步拆分为平台无关层
